name: Update OSS Contributions
on:
  schedule:
    - cron: '32 17 * * *'  # 매일 오전 9시 (UTC 기준)
  workflow_dispatch:

permissions:
  contents: write

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Fetch OSS Activities
        env:
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
          GITHUB_USER: hsyeun
        run: |
          echo "" > react_activity.md
          gh api -H "Accept: application/vnd.github+json" \
            "/search/issues?q=repo:facebook/react+commenter:${GITHUB_USER}" \
            --jq '.items[] | "- 💬 [#" + (.number|tostring) + "](" + .html_url + ") " + .title + " (" + (.updated_at[0:10]) + ")"' \
            | head -n 10 >> react_activity.md
          
          echo "" >> react_activity.md
          echo "_Last updated: $(date -u '+%Y-%m-%d %H:%M:%S UTC')_" >> react_activity.md
          cat react_activity.md

      - name: Merge into README
        run: |
          awk '
            /<!--REACT_START-->/ {print; system("cat react_activity.md"); skip=1; next}
            /<!--REACT_END-->/ {skip=0}
            !skip
          ' README.md > tmp && mv tmp README.md

      - name: Commit & Push
        uses: EndBug/add-and-commit@v9
        with:
          message: "chore: update OSS contribution activity"
          add: 'README.md'
